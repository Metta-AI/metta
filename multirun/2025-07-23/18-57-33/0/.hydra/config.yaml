run: test_env_context
dist_cfg_path: null
data_dir: ${oc.env:DATA_DIR,./train_dir}
run_dir: ${data_dir}/${run}
policy_uri: file://${run_dir}/checkpoints
torch_deterministic: true
seed: 1
device: cuda
vectorization: multiprocessing
stats_server_uri: https://api.observatory.softmax-research.net
agent:
  _target_: metta.agent.metta_agent.MettaAgent
  observations:
    obs_key: grid_obs
  clip_range: 0
  analyze_weights_interval: 300
  l2_init_weight_update_interval: 0
  environmental_context:
    enabled: true
    strategy: input_sum
    embedding_dim: 128
    num_task_embeddings: 1000
  components:
    _obs_:
      _target_: metta.agent.lib.obs_token_to_box_shaper.ObsTokenToBoxShaper
      sources: null
    obs_normalizer:
      _target_: metta.agent.lib.observation_normalizer.ObservationNormalizer
      sources:
      - name: _obs_
    cnn1:
      _target_: metta.agent.lib.nn_layer_library.Conv2d
      sources:
      - name: obs_normalizer
      nn_params:
        out_channels: 64
        kernel_size: 5
        stride: 3
    cnn2:
      _target_: metta.agent.lib.nn_layer_library.Conv2d
      sources:
      - name: cnn1
      nn_params:
        out_channels: 64
        kernel_size: 3
        stride: 1
    obs_flattener:
      _target_: metta.agent.lib.nn_layer_library.Flatten
      sources:
      - name: cnn2
    fc1:
      _target_: metta.agent.lib.nn_layer_library.Linear
      sources:
      - name: obs_flattener
      nn_params:
        out_features: 128
    encoded_obs:
      _target_: metta.agent.lib.nn_layer_library.Linear
      sources:
      - name: fc1
      nn_params:
        out_features: 128
    environmental_context_embedding:
      _target_: metta.agent.lib.environmental_context.EnvironmentalContextEmbedding
      sources:
      - name: encoded_obs
      embedding_dim: 128
      num_task_embeddings: 1000
      strategy: input_sum
    _core_:
      _target_: metta.agent.lib.lstm.LSTM
      sources:
      - name: environmental_context_embedding
      output_size: 128
      nn_params:
        num_layers: 2
    critic_1:
      _target_: metta.agent.lib.nn_layer_library.Linear
      sources:
      - name: _core_
      nn_params:
        out_features: 1024
      nonlinearity: nn.Tanh
      effective_rank: true
    _value_:
      _target_: metta.agent.lib.nn_layer_library.Linear
      sources:
      - name: critic_1
      nn_params:
        out_features: 1
      nonlinearity: null
    actor_1:
      _target_: metta.agent.lib.nn_layer_library.Linear
      sources:
      - name: _core_
      nn_params:
        out_features: 512
    _action_embeds_:
      _target_: metta.agent.lib.action.ActionEmbedding
      sources: null
      nn_params:
        num_embeddings: 100
        embedding_dim: 16
    _action_:
      _target_: metta.agent.lib.actor.MettaActorSingleHead
      sources:
      - name: actor_1
      - name: _action_embeds_
trainer:
  _target_: metta.rl.trainer.MettaTrainer
  num_workers: 1
  curriculum: env/mettagrid/curriculum/navigation/prioritize_regressed
  env_overrides: {}
  initial_policy:
    uri: null
    type: top
    range: 1
    metric: epoch
    filters: {}
  checkpoint:
    checkpoint_dir: ${run_dir}/checkpoints
    checkpoint_interval: 50
    wandb_checkpoint_interval: 50
  simulation:
    evaluate_interval: 200
    replay_dir: s3://softmax-public/replays/${run}
  grad_mean_variance_interval: 0
  total_timesteps: 10000
  optimizer:
    type: adam
    beta1: 0.9
    beta2: 0.999
    eps: 1.0e-12
    learning_rate: 0.000457
    weight_decay: 0
  lr_scheduler:
    enabled: false
    anneal_lr: false
    warmup_steps: null
    schedule_type: null
  ppo:
    clip_coef: 0.1
    ent_coef: 0.0021
    gae_lambda: 0.916
    gamma: 0.977
    max_grad_norm: 0.5
    vf_clip_coef: 0.1
    vf_coef: 0.44
    l2_reg_loss_coef: 0
    l2_init_loss_coef: 0
    norm_adv: true
    clip_vloss: true
    target_kl: null
  prioritized_experience_replay:
    prio_alpha: 0.0
    prio_beta0: 0.6
  vtrace:
    vtrace_rho_clip: 1.0
    vtrace_c_clip: 1.0
  zero_copy: true
  require_contiguous_env_ids: false
  verbose: true
  batch_size: 524288
  minibatch_size: 16384
  bptt_horizon: 64
  update_epochs: 1
  cpu_offload: false
  compile: false
  compile_mode: reduce-overhead
  profiler:
    interval_epochs: 10000
    profile_dir: s3://softmax-public/torch_traces/${run}
  forward_pass_minibatch_target_size: 4096
  async_factor: 2
  scale_batches_by_world_size: false
  hyperparameter_scheduler:
    learning_rate_schedule:
      _target_: metta.rl.hyperparameter_scheduler.CosineSchedule
      min_value: 3.0e-05
      initial_value: ${...optimizer.learning_rate}
    ppo_clip_schedule:
      _target_: metta.rl.hyperparameter_scheduler.LogarithmicSchedule
      min_value: 0.05
      decay_rate: 0.1
      initial_value: ${...ppo.clip_coef}
    ppo_ent_coef_schedule:
      _target_: metta.rl.hyperparameter_scheduler.LinearSchedule
      min_value: 0.0
      initial_value: ${...ppo.ent_coef}
    ppo_vf_clip_schedule:
      _target_: metta.rl.hyperparameter_scheduler.LinearSchedule
      min_value: 0.05
      initial_value: ${...ppo.vf_clip_coef}
    ppo_l2_reg_loss_schedule:
      _target_: metta.rl.hyperparameter_scheduler.ConstantSchedule
      initial_value: ${...ppo.l2_reg_loss_coef}
    ppo_l2_init_loss_schedule:
      _target_: metta.rl.hyperparameter_scheduler.ConstantSchedule
      initial_value: ${...ppo.l2_init_loss_coef}
  kickstart:
    teacher_uri: null
    action_loss_coef: 1
    value_loss_coef: 1
    anneal_ratio: 0.65
    kickstart_steps: 1000000000
    additional_teachers: null
sim:
  num_episodes: 1
  max_time_s: 60
  env_overrides: {}
  name: navigation
  simulations:
    navigation/emptyspace_withinsight:
      env: env/mettagrid/navigation/evals/emptyspace_withinsight
    navigation/emptyspace_outofsight:
      env: env/mettagrid/navigation/evals/emptyspace_outofsight
    navigation/emptyspace_sparse:
      env: env/mettagrid/navigation/evals/emptyspace_sparse
    navigation/emptyspace_sparse_medium:
      env: env/mettagrid/navigation/evals/emptyspace_sparse_medium
    navigation/walls_withinsight:
      env: env/mettagrid/navigation/evals/walls_withinsight
    navigation/walls_outofsight:
      env: env/mettagrid/navigation/evals/walls_outofsight
    navigation/walls_sparse:
      env: env/mettagrid/navigation/evals/walls_sparse
    navigation/cylinder:
      env: env/mettagrid/navigation/evals/cylinder
    navigation/obstacles0:
      env: env/mettagrid/navigation/evals/obstacles0
    navigation/obstacles1:
      env: env/mettagrid/navigation/evals/obstacles1
    navigation/obstacles2:
      env: env/mettagrid/navigation/evals/obstacles2
    navigation/obstacles3:
      env: env/mettagrid/navigation/evals/obstacles3
    navigation/corridors:
      env: env/mettagrid/navigation/evals/corridors
    navigation/labyrinth:
      env: env/mettagrid/navigation/evals/labyrinth
    navigation/radialmaze:
      env: env/mettagrid/navigation/evals/radialmaze
    navigation/cylinder_easy:
      env: env/mettagrid/navigation/evals/cylinder_easy
    navigation/honeypot:
      env: env/mettagrid/navigation/evals/honeypot
    navigation/knotty:
      env: env/mettagrid/navigation/evals/knotty
    navigation/memory_palace:
      env: env/mettagrid/navigation/evals/memory_palace
    navigation/radial_large:
      env: env/mettagrid/navigation/evals/radial_large
    navigation/radial_mini:
      env: env/mettagrid/navigation/evals/radial_mini
    navigation/radial_small:
      env: env/mettagrid/navigation/evals/radial_small
    navigation/swirls:
      env: env/mettagrid/navigation/evals/swirls
    navigation/thecube:
      env: env/mettagrid/navigation/evals/thecube
    navigation/walkaround:
      env: env/mettagrid/navigation/evals/walkaround
    navigation/wanderout:
      env: env/mettagrid/navigation/evals/wanderout
    systematic_exploration_memory/boxout:
      env: env/mettagrid/systematic_exploration_memory/evals/boxout
    systematic_exploration_memory/choose_wisely:
      env: env/mettagrid/systematic_exploration_memory/evals/choose_wisely
    systematic_exploration_memory/corners:
      env: env/mettagrid/systematic_exploration_memory/evals/corners
    systematic_exploration_memory/hall_of_mirrors:
      env: env/mettagrid/systematic_exploration_memory/evals/hall_of_mirrors
    systematic_exploration_memory/journey_home:
      env: env/mettagrid/systematic_exploration_memory/evals/journey_home
    systematic_exploration_memory/little_landmark_hard:
      env: env/mettagrid/systematic_exploration_memory/evals/little_landmark_hard
    systematic_exploration_memory/lobster_legs_cues:
      env: env/mettagrid/systematic_exploration_memory/evals/lobster_legs_cues
    systematic_exploration_memory/lobster_legs:
      env: env/mettagrid/systematic_exploration_memory/evals/lobster_legs
    systematic_exploration_memory/memory_swirls_hard:
      env: env/mettagrid/systematic_exploration_memory/evals/memory_swirls_hard
    systematic_exploration_memory/memory_swirls:
      env: env/mettagrid/systematic_exploration_memory/evals/memory_swirls
    systematic_exploration_memory/passing_things:
      env: env/mettagrid/systematic_exploration_memory/evals/passing_things
    systematic_exploration_memory/rooms:
      env: env/mettagrid/systematic_exploration_memory/evals/rooms
    systematic_exploration_memory/spacey_memory:
      env: env/mettagrid/systematic_exploration_memory/evals/spacey_memory
    systematic_exploration_memory/tease:
      env: env/mettagrid/systematic_exploration_memory/evals/tease
    systematic_exploration_memory/venture_out:
      env: env/mettagrid/systematic_exploration_memory/evals/venture_out
    systematic_exploration_memory/you_shall_not_pass:
      env: env/mettagrid/systematic_exploration_memory/evals/you_shall_not_pass
wandb:
  enabled: true
  project: metta
  entity: metta-research
  group: ${run}
  name: ${run}
  run_id: ${run}
  data_dir: ${run_dir}
  job_type: ${cmd}
  tags: []
  notes: ''
train_job:
  map_preview_uri: s3://softmax-public/training_runs/${run}/map_preview.json.z
  evals: ${sim}
cmd: train
