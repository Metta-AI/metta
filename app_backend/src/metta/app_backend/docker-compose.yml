services:
  eval-worker-orchestrator:
    image: metta-local:latest  # Note you can build this at devops/docker/build-local.sh
    environment:
      - BACKEND_URL=${BACKEND_URL:-http://host.docker.internal:8000}
      - WORKER_IDLE_TIMEOUT=${WORKER_IDLE_TIMEOUT:-600}
      - PYTHONPATH=/workspace/metta
      - TRAIN_DIR_HOST_PATH=/Users/nishadsingh/repos/metta2/train_dir
      - DOCKER_IMAGE=metta-local:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ../../../../train_dir:/workspace/train_dir
    command: [ "uv", "run", "python", "-m", "metta.app_backend.eval_task_orchestrator" ]
    network_mode: "host"
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
