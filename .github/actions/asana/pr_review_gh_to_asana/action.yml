name: "PR Review (GH To Asana)"
description: "Ensures an Asana task exists with the given GitHub URL. Creates a new task if none is found."

inputs:
  task_url:
    description: "The Asana project ID where the task will be created."
    required: true
  state:
    description: "The Asana workspace ID for searching tasks."
    required: true
  asana_token:
    description: "The Asana personal access token."
    required: true
  author:
    description: "The GitHub URL (PR or issue) to associate with the Asana task."
    required: true
  comment:
    description: "The Asana custom field ID for the 'GitHub URL' field."
    required: true


outputs:
  task_url:
    description: "The URL of the existing or created Asana task."
    value: ${{ steps.ensure-task.outputs.task_url }}

runs:
  using: "composite"
  steps:
    - name: Install uv
      uses: astral-sh/setup-uv@v6
      with:
        version: "0.7.3"
        enable-cache: true

    - name: Sync PR Review GH To Asana
      id: sync-pr-review-gh-to-asana
      run: uv run ${{ github.action_path }}/pr_review_gh_to_asana.py
      shell: bash
      env:
        INPUT_TASK_URL: ${{ inputs.task_url }}
        INPUT_STATE: ${{ inputs.state }}
        INPUT_ASANA_TOKEN: ${{ inputs.asana_token }}
        INPUT_AUTHOR: ${{ inputs.author }}
        INPUT_COMMENT: ${{ inputs.comment }}


