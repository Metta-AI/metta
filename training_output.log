[22:01:36.397458] INFO     Registered 23 custom resolvers at    resolvers.py:280
                           the start of a run                                   
[2025-06-04 22:01:36,432][botocore.credentials][INFO] - Found credentials from IAM Role: rvpc-us2-runner-ec2-role
[22:01:36.634516] INFO     Train job config: run:                    train.py:65
                           test_training_minimal                                
                           dist_cfg_path: null                                  
                           data_dir: ./train_dir                                
                           run_dir:                                             
                           ./train_dir/test_training_minimal                    
                           policy_uri:                                          
                           file://./train_dir/test_training_minimal/            
                           checkpoints                                          
                           torch_deterministic: true                            
                           vectorization: multiprocessing                       
                           seed: 1                                              
                           device: cpu                                          
                           agent:                                               
                             _target_:                                          
                           metta.agent.metta_agent.MettaAgent                   
                             observations:                                      
                               obs_key: grid_obs                                
                             clip_range: 0                                      
                             analyze_weights_interval: 300                      
                             l2_init_weight_update_interval: 0                  
                             components:                                        
                               _obs_:                                           
                                 _target_:                                      
                           metta.agent.lib.obs_shaper.ObsShaper                 
                                 sources: null                                  
                               obs_normalizer:                                  
                                 _target_:                                      
                           metta.agent.lib.observation_normalizer.Ob            
                           servationNormalizer                                  
                                 sources:                                       
                                 - name: _obs_                                  
                               cnn1:                                            
                                 _target_:                                      
                           metta.agent.lib.nn_layer_library.Conv2d              
                                 sources:                                       
                                 - name: obs_normalizer                         
                                 nn_params:                                     
                                   out_channels: 64                             
                                   kernel_size: 5                               
                                   stride: 3                                    
                               cnn2:                                            
                                 _target_:                                      
                           metta.agent.lib.nn_layer_library.Conv2d              
                                 sources:                                       
                                 - name: cnn1                                   
                                 nn_params:                                     
                                   out_channels: 64                             
                                   kernel_size: 3                               
                                   stride: 1                                    
                               obs_flattener:                                   
                                 _target_:                                      
                           metta.agent.lib.nn_layer_library.Flatten             
                                 sources:                                       
                                 - name: cnn2                                   
                               fc1:                                             
                                 _target_:                                      
                           metta.agent.lib.nn_layer_library.Linear              
                                 sources:                                       
                                 - name: obs_flattener                          
                                 nn_params:                                     
                                   out_features: 128                            
                               encoded_obs:                                     
                                 _target_:                                      
                           metta.agent.lib.nn_layer_library.Linear              
                                 sources:                                       
                                 - name: fc1                                    
                                 nn_params:                                     
                                   out_features: 128                            
                               _core_:                                          
                                 _target_: metta.agent.lib.lstm.LSTM            
                                 sources:                                       
                                 - name: encoded_obs                            
                                 output_size: 128                               
                                 nn_params:                                     
                                   num_layers: 2                                
                               core_relu:                                       
                                 _target_:                                      
                           metta.agent.lib.nn_layer_library.ReLU                
                                 sources:                                       
                                 - name: _core_                                 
                               critic_1:                                        
                                 _target_:                                      
                           metta.agent.lib.nn_layer_library.Linear              
                                 sources:                                       
                                 - name: core_relu                              
                                 nn_params:                                     
                                   out_features: 1024                           
                                 nonlinearity: nn.Tanh                          
                                 effective_rank: true                           
                               _value_:                                         
                                 _target_:                                      
                           metta.agent.lib.nn_layer_library.Linear              
                                 sources:                                       
                                 - name: critic_1                               
                                 nn_params:                                     
                                   out_features: 1                              
                                 nonlinearity: null                             
                               actor_1:                                         
                                 _target_:                                      
                           metta.agent.lib.nn_layer_library.Linear              
                                 sources:                                       
                                 - name: core_relu                              
                                 nn_params:                                     
                                   out_features: 512                            
                               _action_embeds_:                                 
                                 _target_:                                      
                           metta.agent.lib.action.ActionEmbedding               
                                 sources: null                                  
                                 nn_params:                                     
                                   num_embeddings: 100                          
                                   embedding_dim: 16                            
                               _action_:                                        
                                 _target_:                                      
                           metta.agent.lib.actor.MettaActorSingleHea            
                           d                                                    
                                 sources:                                       
                                 - name: actor_1                                
                                 - name: _action_embeds_                        
                           trainer:                                             
                             num_workers: 1                                     
                             curriculum:                                        
                           /env/mettagrid/curriculum/simple                     
                             env_overrides: {}                                  
                             initial_policy:                                    
                               uri: null                                        
                               type: top                                        
                               range: 1                                         
                               metric: epoch                                    
                               filters: {}                                      
                             checkpoint_dir:                                    
                           ./train_dir/test_training_minimal/checkpo            
                           ints                                                 
                             evaluate_interval: 300                             
                             checkpoint_interval: 60                            
                             wandb_checkpoint_interval: 300                     
                             replay_interval: 300                               
                             replay_dir:                                        
                           s3://softmax-public/replays/test_training            
                           _minimal                                             
                             average_reward: false                              
                             average_reward_alpha: 0.01                         
                             _target_:                                          
                           metta.rl.pufferlib.trainer.PufferTrainer             
                             resume: true                                       
                             use_e3b: false                                     
                             total_timesteps: 1000                              
                             clip_coef: 0.1                                     
                             ent_coef: 0.0021                                   
                             gae_lambda: 0.916                                  
                             gamma: 0.977                                       
                             optimizer:                                         
                               type: adam                                       
                               beta1: 0.9                                       
                               beta2: 0.999                                     
                               eps: 1.0e-12                                     
                               learning_rate: 0.0004573146765703167             
                             lr_scheduler:                                      
                               enabled: false                                   
                             max_grad_norm: 0.5                                 
                             vf_clip_coef: 0.1                                  
                             vf_coef: 0.44                                      
                             l2_reg_loss_coef: 0                                
                             l2_init_loss_coef: 0                               
                             norm_adv: true                                     
                             clip_vloss: true                                   
                             target_kl: null                                    
                             zero_copy: true                                    
                             require_contiguous_env_ids: false                  
                             verbose: true                                      
                             batch_size: 256                                    
                             minibatch_size: 64                                 
                             bptt_horizon: 64                                   
                             update_epochs: 1                                   
                             cpu_offload: false                                 
                             compile: false                                     
                             compile_mode: reduce-overhead                      
                             profiler_interval_epochs: 10000                    
                             forward_pass_minibatch_target_size:                
                           2048                                                 
                             async_factor: 2                                    
                             stats:                                             
                               overview:                                        
                                 episode/reward.mean: episode_reward            
                               step: train/agent_step                           
                             kickstart:                                         
                               teacher_uri: null                                
                               action_loss_coef: 1                              
                               value_loss_coef: 1                               
                               kickstart_steps: 50000000                        
                               additional_teachers: null                        
                           sim:                                                 
                             num_episodes: 1                                    
                             max_time_s: 10                                     
                             env_overrides: {}                                  
                             name: smoke_test                                   
                             simulations:                                       
                               emptyspace_withinsight:                          
                                 env:                                           
                           env/mettagrid/navigation/evals/emptyspace            
                           _withinsight                                         
                           wandb:                                               
                             enabled: false                                     
                           train_job:                                           
                             map_preview_uri:                                   
                           s3://softmax-public/training_runs/test_tr            
                           aining_minimal/map_preview.json.z                    
                             evals:                                             
                               num_episodes: 1                                  
                               max_time_s: 10                                   
                               env_overrides: {}                                
                               name: smoke_test                                 
                               simulations:                                     
                                 emptyspace_withinsight:                        
                                   env:                                         
                           env/mettagrid/navigation/evals/emptyspace            
                           _withinsight                                         
                           cmd: train                                           
                                                                                
[22:01:36.644418] INFO     Training test_training_minimal on 0: 0    train.py:67
                           (cpu)                                                
[22:01:36.645419] INFO     Training test_training_minimal on cpu     train.py:79
Error executing job with overrides: ['sim=smoke_test', 'wandb=off', 'trainer.total_timesteps=1000', 'trainer.batch_size=256', 'trainer.minibatch_size=64', 'trainer.num_workers=1', 'device=cpu', 'run=test_training_minimal']
Error in call to target 'metta.rl.pufferlib.trainer.PufferTrainer':
APIUsageError('batch_size must be divisible by (num_envs / num_workers)')
full_key: trainer

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
