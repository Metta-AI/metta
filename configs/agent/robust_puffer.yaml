# see reference_design.yaml for explanation of components
_target_: metta.agent.metta_agent.MettaAgent

observations:
  obs_key: grid_obs
  track_last_action: false

clip_range: 0 # set to 0 to disable clipping
analyze_weights_interval: 300
l2_init_weight_update_interval: 0

components:
  #necessary layers: _core_, _action_embeds_, _action_, _value_
  #necessary input_source: _obs_

  _obs_:
    _target_: metta.agent.lib.obs_shaper.ObsShaper
    sources: 
      null

  obs_normalizer:
    _target_: metta.agent.lib.observation_normalizer.ObservationNormalizer
    sources:
      - name: _obs_

  cnn1:
    _target_: metta.agent.lib.nn_layer_library.Conv2d
    sources:
      - name: obs_normalizer
    nn_params:
      out_channels: 128
      kernel_size: 5
      stride: 3

  cnn2:
    _target_: metta.agent.lib.nn_layer_library.Conv2d
    sources:
      - name: cnn1
    nn_params:
      out_channels: 128
      kernel_size: 3
      stride: 1

  obs_flattener:
    _target_: metta.agent.lib.nn_layer_library.Flatten
    sources:
      - name: cnn2

  encoded_cnn_linear:
    _target_: metta.agent.lib.nn_layer_library.Linear
    sources:
      - name: obs_flattener
    nn_params:
      out_features: 256

  center_pixels:
    _target_: metta.agent.lib.merge_layer.CenterPixelLayer
    sources:
      - name: obs_normalizer

  pixel_linear:
    _target_: metta.agent.lib.nn_layer_library.Linear
    sources:
      - name: center_pixels
    nn_params:
      out_features: 256

  enc_obs_merge_center_pixels:
    _target_: metta.agent.lib.merge_layer.ConcatMergeLayer
    sources:
      - name: encoded_cnn_linear
      - name: pixel_linear

  _core_:
    _target_: metta.agent.lib.lstm.LSTM
    sources:
      - name: enc_obs_merge_center_pixels
    output_size: 512
    nn_params:
      num_layers: 1

  _value_:
    _target_: metta.agent.lib.nn_layer_library.Linear
    sources:
      - name: _core_
    nn_params:
      out_features: 1
    nonlinearity: null

  _action_embeds_:
    _target_: metta.agent.lib.action.ActionEmbedding
    sources:
      null
    nn_params:
      num_embeddings: 50
      embedding_dim: 512

  _action_:
    _target_: metta.agent.lib.actor.PufferActor
    sources:
      - name: _core_
      - name: _action_embeds_
