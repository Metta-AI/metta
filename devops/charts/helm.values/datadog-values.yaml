# Datadog Agent configuration for Metta k8s infrastructure
# Shared defaults are in devops/datadog/defaults.yaml
env: "production"

datadog:
  # API key should be stored in a Kubernetes secret
  apiKeyExistingSecret: datadog-secret

  # Cluster name for identification
  clusterName: "main"

  # Datadog site (US instance) - also in defaults.yaml
  site: datadoghq.com

  # APM configuration - also in defaults.yaml
  apm:
    portEnabled: true
    port: 8126

  # Log collection - also in defaults.yaml
  logs:
    enabled: true
    containerCollectAll: true

  # Process monitoring - also in defaults.yaml
  # Disabled to reduce billing
  processAgent:
    processCollection:
      enabled: false

  # Kubernetes orchestrator explorer
  orchestratorExplorer:
    enabled: true

  # Global tags applied to all metrics
  tags:
    - "env:production"

  # Exclude ephemeral eval workers from infrastructure metrics to reduce billing
  # Logs and APM traces are still collected for all containers
  # https://docs.datadoghq.com/containers/guide/container-discovery-management/
  containerExcludeMetrics: "kube_namespace:orchestrator kube_namespace:monitoring kube_namespace:jobs"

# DaemonSet agent configuration
clusterAgent:
  replicas: 2
  pdb:
    create: true

agents:
  enabled: true
  useHostNetwork: true
  tolerations:
    - key: workload-type
      operator: Equal
      value: eval-worker
      effect: NoSchedule
