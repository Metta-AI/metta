name: "Test Set GitHub Commit Status"

on:
  workflow_dispatch:
    inputs:
      ref:
        description: "Commit SHA or PR number (e.g., 123)"
        required: true
      pass:
        description: "Mark as passing? true/false"
        required: false
        default: "true"

permissions:
  contents: read
  statuses: write
  pull-requests: write
  issues: write

jobs:
  set-status:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup uv
        uses: ./.github/actions/setup-uv
        with:
          install-mode: "testing"

      - name: Install metta-common
        run: uv pip install ./common

      - name: Run status test script
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          INPUT_REF: ${{ inputs.ref }}
          INPUT_PASS: ${{ inputs.pass }}
          GITHUB_RUN_URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
          GITHUB_REPOSITORY: ${{ github.repository }}
        run: uv run .github/scripts/test-set-commit-status.py
