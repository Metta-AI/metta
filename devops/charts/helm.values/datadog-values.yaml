# Datadog Agent configuration for Metta infrastructure
# Environment tag for all metrics and traces
env: "production"

datadog:
  # API key should be stored in a Kubernetes secret
  apiKeyExistingSecret: datadog-secret

  # Cluster name for identification
  clusterName: "main"

  # Datadog site (US instance)
  site: datadoghq.com

  # APM configuration for distributed tracing
  apm:
    portEnabled: true
    port: 8126

  # Log collection configuration
  logs:
    enabled: true
    containerCollectAll: true

  # Process monitoring - disabled to reduce billing on ephemeral hosts
  processAgent:
    enabled: false
    processCollection: false

  # Kubernetes orchestrator explorer
  orchestratorExplorer:
    enabled: true

  # Global tags applied to all metrics
  tags:
    - "env:production"

  # Exclude ephemeral eval workers from infrastructure metrics to reduce billing
  # Logs and APM traces are still collected for all containers
  # https://docs.datadoghq.com/containers/guide/container-discovery-management/
  containerExcludeMetrics: "kube_namespace:orchestrator kube_namespace:monitoring"

# DaemonSet agent configuration
clusterAgent:
  replicas: 2
  pdb:
    create: true

agents:
  enabled: true
  useHostNetwork: true
  tolerations:
    - key: workload-type
      operator: Equal
      value: eval-worker
      effect: NoSchedule
