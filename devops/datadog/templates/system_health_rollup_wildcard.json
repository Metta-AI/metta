{
  "title": "System Health Rollup (Wildcard)",
  "description": "FoM grid using Wildcard widget with Vega-Lite visualization - no external storage required!",
  "layout_type": "ordered",
  "template_variables": [],
  "widgets": [
    {
      "definition": {
        "title": "System Health FoM Grid (7Ã—7)",
        "title_size": "16",
        "title_align": "left",
        "type": "wildcard",
        "requests": [
          {
            "response_format": "scalar",
            "queries": [
              {
                "query": "avg:health.ci.tests_passing.fom{*}.timeshift(-6d)",
                "data_source": "metrics",
                "name": "tests_passing_6d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.tests_passing.fom{*}.timeshift(-5d)",
                "data_source": "metrics",
                "name": "tests_passing_5d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.tests_passing.fom{*}.timeshift(-4d)",
                "data_source": "metrics",
                "name": "tests_passing_4d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.tests_passing.fom{*}.timeshift(-3d)",
                "data_source": "metrics",
                "name": "tests_passing_3d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.tests_passing.fom{*}.timeshift(-2d)",
                "data_source": "metrics",
                "name": "tests_passing_2d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.tests_passing.fom{*}.timeshift(-1d)",
                "data_source": "metrics",
                "name": "tests_passing_1d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.tests_passing.fom{*}",
                "data_source": "metrics",
                "name": "tests_passing_today",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.failing_workflows.fom{*}.timeshift(-6d)",
                "data_source": "metrics",
                "name": "failing_workflows_6d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.failing_workflows.fom{*}.timeshift(-5d)",
                "data_source": "metrics",
                "name": "failing_workflows_5d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.failing_workflows.fom{*}.timeshift(-4d)",
                "data_source": "metrics",
                "name": "failing_workflows_4d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.failing_workflows.fom{*}.timeshift(-3d)",
                "data_source": "metrics",
                "name": "failing_workflows_3d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.failing_workflows.fom{*}.timeshift(-2d)",
                "data_source": "metrics",
                "name": "failing_workflows_2d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.failing_workflows.fom{*}.timeshift(-1d)",
                "data_source": "metrics",
                "name": "failing_workflows_1d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.failing_workflows.fom{*}",
                "data_source": "metrics",
                "name": "failing_workflows_today",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.hotfix_count.fom{*}.timeshift(-6d)",
                "data_source": "metrics",
                "name": "hotfix_count_6d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.hotfix_count.fom{*}.timeshift(-5d)",
                "data_source": "metrics",
                "name": "hotfix_count_5d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.hotfix_count.fom{*}.timeshift(-4d)",
                "data_source": "metrics",
                "name": "hotfix_count_4d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.hotfix_count.fom{*}.timeshift(-3d)",
                "data_source": "metrics",
                "name": "hotfix_count_3d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.hotfix_count.fom{*}.timeshift(-2d)",
                "data_source": "metrics",
                "name": "hotfix_count_2d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.hotfix_count.fom{*}.timeshift(-1d)",
                "data_source": "metrics",
                "name": "hotfix_count_1d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.hotfix_count.fom{*}",
                "data_source": "metrics",
                "name": "hotfix_count_today",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.revert_count.fom{*}.timeshift(-6d)",
                "data_source": "metrics",
                "name": "revert_count_6d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.revert_count.fom{*}.timeshift(-5d)",
                "data_source": "metrics",
                "name": "revert_count_5d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.revert_count.fom{*}.timeshift(-4d)",
                "data_source": "metrics",
                "name": "revert_count_4d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.revert_count.fom{*}.timeshift(-3d)",
                "data_source": "metrics",
                "name": "revert_count_3d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.revert_count.fom{*}.timeshift(-2d)",
                "data_source": "metrics",
                "name": "revert_count_2d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.revert_count.fom{*}.timeshift(-1d)",
                "data_source": "metrics",
                "name": "revert_count_1d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.revert_count.fom{*}",
                "data_source": "metrics",
                "name": "revert_count_today",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.duration_p90.fom{*}.timeshift(-6d)",
                "data_source": "metrics",
                "name": "duration_p90_6d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.duration_p90.fom{*}.timeshift(-5d)",
                "data_source": "metrics",
                "name": "duration_p90_5d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.duration_p90.fom{*}.timeshift(-4d)",
                "data_source": "metrics",
                "name": "duration_p90_4d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.duration_p90.fom{*}.timeshift(-3d)",
                "data_source": "metrics",
                "name": "duration_p90_3d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.duration_p90.fom{*}.timeshift(-2d)",
                "data_source": "metrics",
                "name": "duration_p90_2d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.duration_p90.fom{*}.timeshift(-1d)",
                "data_source": "metrics",
                "name": "duration_p90_1d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.duration_p90.fom{*}",
                "data_source": "metrics",
                "name": "duration_p90_today",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.stale_prs.fom{*}.timeshift(-6d)",
                "data_source": "metrics",
                "name": "stale_prs_6d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.stale_prs.fom{*}.timeshift(-5d)",
                "data_source": "metrics",
                "name": "stale_prs_5d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.stale_prs.fom{*}.timeshift(-4d)",
                "data_source": "metrics",
                "name": "stale_prs_4d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.stale_prs.fom{*}.timeshift(-3d)",
                "data_source": "metrics",
                "name": "stale_prs_3d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.stale_prs.fom{*}.timeshift(-2d)",
                "data_source": "metrics",
                "name": "stale_prs_2d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.stale_prs.fom{*}.timeshift(-1d)",
                "data_source": "metrics",
                "name": "stale_prs_1d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.stale_prs.fom{*}",
                "data_source": "metrics",
                "name": "stale_prs_today",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.pr_cycle_time.fom{*}.timeshift(-6d)",
                "data_source": "metrics",
                "name": "pr_cycle_time_6d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.pr_cycle_time.fom{*}.timeshift(-5d)",
                "data_source": "metrics",
                "name": "pr_cycle_time_5d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.pr_cycle_time.fom{*}.timeshift(-4d)",
                "data_source": "metrics",
                "name": "pr_cycle_time_4d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.pr_cycle_time.fom{*}.timeshift(-3d)",
                "data_source": "metrics",
                "name": "pr_cycle_time_3d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.pr_cycle_time.fom{*}.timeshift(-2d)",
                "data_source": "metrics",
                "name": "pr_cycle_time_2d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.pr_cycle_time.fom{*}.timeshift(-1d)",
                "data_source": "metrics",
                "name": "pr_cycle_time_1d",
                "aggregator": "last"
              },
              {
                "query": "avg:health.ci.pr_cycle_time.fom{*}",
                "data_source": "metrics",
                "name": "pr_cycle_time_today",
                "aggregator": "last"
              }
            ]
          }
        ],
        "specification": {
          "type": "vega-lite",
          "contents": {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "data": {
              "name": "table1"
            },
            "transform": [
              {
                "fold": [
                  "tests_passing_6d",
                  "tests_passing_5d",
                  "tests_passing_4d",
                  "tests_passing_3d",
                  "tests_passing_2d",
                  "tests_passing_1d",
                  "tests_passing_today",
                  "failing_workflows_6d",
                  "failing_workflows_5d",
                  "failing_workflows_4d",
                  "failing_workflows_3d",
                  "failing_workflows_2d",
                  "failing_workflows_1d",
                  "failing_workflows_today",
                  "hotfix_count_6d",
                  "hotfix_count_5d",
                  "hotfix_count_4d",
                  "hotfix_count_3d",
                  "hotfix_count_2d",
                  "hotfix_count_1d",
                  "hotfix_count_today",
                  "revert_count_6d",
                  "revert_count_5d",
                  "revert_count_4d",
                  "revert_count_3d",
                  "revert_count_2d",
                  "revert_count_1d",
                  "revert_count_today",
                  "duration_p90_6d",
                  "duration_p90_5d",
                  "duration_p90_4d",
                  "duration_p90_3d",
                  "duration_p90_2d",
                  "duration_p90_1d",
                  "duration_p90_today",
                  "stale_prs_6d",
                  "stale_prs_5d",
                  "stale_prs_4d",
                  "stale_prs_3d",
                  "stale_prs_2d",
                  "stale_prs_1d",
                  "stale_prs_today",
                  "pr_cycle_time_6d",
                  "pr_cycle_time_5d",
                  "pr_cycle_time_4d",
                  "pr_cycle_time_3d",
                  "pr_cycle_time_2d",
                  "pr_cycle_time_1d",
                  "pr_cycle_time_today"
                ],
                "as": [
                  "metric_day",
                  "value"
                ]
              },
              {
                "calculate": "split(datum.metric_day, '_')[0] + (indexof(datum.metric_day, 'passing') > 0 ? ' passing' : (indexof(datum.metric_day, 'workflows') > 0 ? ' workflows' : (indexof(datum.metric_day, 'count') > 0 ? ' count' : (indexof(datum.metric_day, 'p90') > 0 ? ' p90' : (indexof(datum.metric_day, 'prs') > 0 ? ' prs' : ' time')))))",
                "as": "metric_raw"
              },
              {
                "calculate": "indexof(datum.metric_day, 'today') > 0 ? 'Today' : ('-' + split(datum.metric_day, '_')[length(split(datum.metric_day, '_')) - 1])",
                "as": "day"
              },
              {
                "calculate": "replace(replace(replace(replace(replace(replace(replace(datum.metric_day, '_today', ''), '_1d', ''), '_2d', ''), '_3d', ''), '_4d', ''), '_5d', ''), '_6d', '')",
                "as": "metric_key"
              },
              {
                "calculate": "datum.metric_key == 'tests_passing' ? 'Tests Passing' : (datum.metric_key == 'failing_workflows' ? 'Failing Workflows' : (datum.metric_key == 'hotfix_count' ? 'Hotfix Count' : (datum.metric_key == 'revert_count' ? 'Revert Count' : (datum.metric_key == 'duration_p90' ? 'CI Duration P90' : (datum.metric_key == 'stale_prs' ? 'Stale PRs' : 'PR Cycle Time')))))",
                "as": "metric"
              }
            ],
            "layer": [
              {
                "mark": {
                  "type": "rect",
                  "stroke": "#333",
                  "strokeWidth": 1
                },
                "encoding": {
                  "y": {
                    "field": "metric",
                    "type": "nominal",
                    "title": null,
                    "sort": [
                      "Tests Passing",
                      "Failing Workflows",
                      "Hotfix Count",
                      "Revert Count",
                      "CI Duration P90",
                      "Stale PRs",
                      "PR Cycle Time"
                    ],
                    "axis": {
                      "labelAngle": 0,
                      "labelPadding": 10
                    }
                  },
                  "x": {
                    "field": "day",
                    "type": "ordinal",
                    "title": null,
                    "sort": [
                      "-6d",
                      "-5d",
                      "-4d",
                      "-3d",
                      "-2d",
                      "-1d",
                      "Today"
                    ],
                    "axis": {
                      "labelAngle": 0
                    }
                  },
                  "color": {
                    "field": "value",
                    "type": "quantitative",
                    "scale": {
                      "domain": [
                        0,
                        0.3,
                        0.7,
                        1.0
                      ],
                      "range": [
                        "#dc3545",
                        "#ffc107",
                        "#ffc107",
                        "#28a745"
                      ],
                      "type": "threshold"
                    },
                    "legend": {
                      "title": "FoM Score"
                    }
                  },
                  "tooltip": [
                    {
                      "field": "metric",
                      "type": "nominal",
                      "title": "Metric"
                    },
                    {
                      "field": "day",
                      "type": "ordinal",
                      "title": "Day"
                    },
                    {
                      "field": "value",
                      "type": "quantitative",
                      "title": "FoM",
                      "format": ".3f"
                    }
                  ]
                }
              },
              {
                "mark": {
                  "type": "text",
                  "fontSize": 14,
                  "fontWeight": "bold"
                },
                "encoding": {
                  "y": {
                    "field": "metric",
                    "type": "nominal",
                    "sort": [
                      "Tests Passing",
                      "Failing Workflows",
                      "Hotfix Count",
                      "Revert Count",
                      "CI Duration P90",
                      "Stale PRs",
                      "PR Cycle Time"
                    ]
                  },
                  "x": {
                    "field": "day",
                    "type": "ordinal",
                    "sort": [
                      "-6d",
                      "-5d",
                      "-4d",
                      "-3d",
                      "-2d",
                      "-1d",
                      "Today"
                    ]
                  },
                  "text": {
                    "field": "value",
                    "type": "quantitative",
                    "format": ".2f"
                  },
                  "color": {
                    "condition": {
                      "test": "datum.value < 0.5",
                      "value": "white"
                    },
                    "value": "black"
                  }
                }
              }
            ],
            "config": {
              "view": {
                "stroke": null
              },
              "axis": {
                "grid": false,
                "domain": false,
                "ticks": false
              }
            }
          }
        }
      },
      "layout": {
        "x": 0,
        "y": 0,
        "width": 12,
        "height": 8
      }
    },
    {
      "definition": {
        "type": "note",
        "content": "## System Health Rollup\n\n**Figure of Merit (FoM)** values for CI/CD metrics over 7 days.\n\nðŸŸ¢ Green (0.7-1.0) = Healthy | ðŸŸ¡ Yellow (0.3-0.7) = Warning | ðŸ”´ Red (0.0-0.3) = Critical\n\nHover over cells for exact values. Click for detailed metric views.",
        "background_color": "gray",
        "font_size": "14",
        "text_align": "left",
        "show_tick": false,
        "has_padding": true
      },
      "layout": {
        "x": 0,
        "y": 8,
        "width": 12,
        "height": 2
      }
    }
  ],
  "notify_list": [],
  "reflow_type": "fixed",
  "id": "bew-kg3-w4f"
}
