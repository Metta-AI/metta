defaults:
  - common
  - wandb: metta_research
  - sweep: full
  - sim: sweep_eval  # Load sweep evaluation sim config
  - _self_

sweep_name: ??? # Will be set via command line override

settings:
  max_consecutive_failures: 5
  rollout_retry_delay: 5
  max_observations_to_load: 250
  sweep_server_uri: https://api.observatory.softmax-research.net

# Base sim configuration for sweep evaluations (separate from training evals)
sim:
  num_episodes: 7  # Default for phase 1
  max_time_s: 240  # 4 minutes per simulation

schedule:
  phases:
    - name: "explore_cheap"
      num_runs: 100 # 100 * 1800 = 180,000s
      overrides:
        sweep:
          protein:
            max_suggestion_cost: 1800
            random_suggestions: 18
            expansion_rate: 0.18
          parameters:
            trainer:
              total_timesteps: { mean: 300000000 }
              batch_size: { mean: 524288 } # 2^19
              minibatch_size: { mean: 8192 } # 2^13
        sim:
          num_episodes: 7  # Quick evaluation for initial exploration

    - name: "exploit_medium"
      num_runs: 70 # 70 * 3600 = 252,000s
      overrides:
        sweep:
          protein:
            max_suggestion_cost: 3600
            random_suggestions: 10
            suggestions_per_pareto: 24
            expansion_rate: 0.10
          parameters:
            trainer:
              total_timesteps: { mean: 750000000 }
              batch_size: { mean: 1048576 } # 2^20
              minibatch_size: { mean: 16384 } # 2^14
        sim:
          num_episodes: 20  # More thorough evaluation for promising candidates

    - name: "peak_expensive"
      num_runs: 11 # 11 * 7200 = 79,200s
      overrides:
        sweep:
          protein:
            max_suggestion_cost: 7200
            random_suggestions: 5
            suggestions_per_pareto: 16
            expansion_rate: 0.06
          parameters:
            trainer:
              total_timesteps: { mean: 1000000000 } # 1B
              batch_size: { mean: 1048576 } # 2^20
              minibatch_size: { mean: 16384 } # 2^14
        sim:
          num_episodes: 50  # High confidence evaluation for final candidates

# Otherwise common will mess with us
run: null

sweep_job_overrides:
  trainer:
    curriculum: /env/mettagrid/arena/basic_easy_shaped
    simulation:
      evaluate_remote: false
      evaluate_local: true
      replay_dir: "" # No replays for sweeps

cmd: sweep
