name: "Build Dashboard CronJob Docker Image"
concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: true

on:
  push:
    branches:
      - main
    paths:
      - "devops/datadog/**"
      - "packages/gitta/**"
      - "devops/charts/dashboard-cronjob/**"
      - ".github/workflows/build-dashboard-image.yml"
  workflow_dispatch:
    inputs:
      branch:
        description: "Branch to build from (defaults to current branch)"
        required: false
        type: string
        default: ""

jobs:
  build-and-deploy:
    uses: ./.github/workflows/build-and-deploy-docker-image.yml
    with:
      image_name: softmax-dashboard
      dockerfile: ./devops/datadog/Dockerfile.collectors
      helm_release: dashboard-cronjob
      helm_namespace: monitoring
      helm_chart: ./devops/charts/dashboard-cronjob
