# MettaScope

MettaScope is a browser viewer to watch metta replays.

## Project layout

- ./mettascope/src/ has the frontend typescript source.
- ./mettascope/server.py is a small python backend for serving replays.
- ./mettascope/tests/ has both frontend UI tests with Playwright, and some python backend tests.
- ./mettascope/index.html do not edit index.html! It is auto generated by an engineer with a script from Figma.

The code is plain TypeScript with no framework.

## Recipe System Commands

| Task        | Command                                                               |
| ----------- | --------------------------------------------------------------------- |
| Interactive | `uv run ./tools/run.py experiments.recipes.arena.play policy_uri=*`   |
| Replays     | `uv run ./tools/run.py experiments.recipes.arena.replay policy_uri=*` |

## Development Commands

All commands are executed from the `mettascope/` directory.

| Task          | Command                             | Notes                                                 |
| ------------- | ----------------------------------- | ----------------------------------------------------- |
| Build once    | `pnpm run build`                    |                                                       |
| Lint & format | `pnpm run lint` / `pnpm run format` | should be run on code changes                         |
| Run tests     | `pnpm run test`                     | frontend tests require the backend is already running |

### Texture Atlas

- a texture atlas is generated from the data/atlas/ directory.
- this is used to generate dist/atlas.png and dist/atlas.json.
- the atlas is generated by running:

```bash
python tools/gen_atlas.py
```

## Commit guidelines

Follow the repository-wide rules described in `/AGENTS.md`:

- Short, present-tense commit messages
- Run lint/format before pushing

## Programming Guidelines

- Important: all code comments should be full sentences and include a period at the end.
- do not write comments that are redundant with code.
- common.ts is imported by most parts of mettascope and contains all the state.
- Most 'magic number' constants should live in ./mettascope/src/common.ts
- code is expected to fail fast and loudly. DO NOT use silent error suppression or error hiding.
  - if a function gets invalid input, we should throw an error.
  - if a function returns an error, allow that error to bubble up.

- ./mettascope/src/vector_math.ts has Vec2f and Mat3f.
- Do not pass X and Y arguments separately. pass them as a Vec2f.
- when working with `gridObject`s, do not access properties directly. you must use `getAttr()` from replay.ts
